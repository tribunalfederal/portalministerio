<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sistema de Notifica√ß√µes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .teste { margin: 10px 0; padding: 10px; border: 1px solid #333; border-radius: 5px; }
        .ok { border-color: green; background: #003300; }
        .erro { border-color: red; background: #330000; }
        .warning { border-color: orange; background: #331100; }
    </style>
</head>
<body>
    <h1>üîî Teste do Sistema de Notifica√ß√µes V4.0</h1>
    
    <div id="resultados"></div>
    
    <script>
        const resultados = document.getElementById('resultados');
        
        function adicionarTeste(nome, status, detalhes) {
            const div = document.createElement('div');
            div.className = `teste ${status}`;
            div.innerHTML = `
                <strong>${nome}</strong><br>
                ${detalhes}
            `;
            resultados.appendChild(div);
        }
        
        // Testar localStorage
        try {
            localStorage.setItem('teste', 'valor');
            localStorage.removeItem('teste');
            adicionarTeste('‚úÖ localStorage', 'ok', 'Funcionando corretamente');
        } catch (error) {
            adicionarTeste('‚ùå localStorage', 'erro', `Erro: ${error.message}`);
        }
        
        // Testar JSON parsing
        try {
            const teste = JSON.parse('[]');
            adicionarTeste('‚úÖ JSON Parse', 'ok', 'Funcionando corretamente');
        } catch (error) {
            adicionarTeste('‚ùå JSON Parse', 'erro', `Erro: ${error.message}`);
        }
        
        // Testar fun√ß√µes b√°sicas
        function testarFuncaoNotificacao() {
            const notificacoesLidas = [];
            
            function foiLida(id) {
                return notificacoesLidas.some(item => {
                    if (typeof item === 'string') {
                        return item === id;
                    }
                    return item.id === id;
                });
            }
            
            function marcarComoLida(id) {
                if (!foiLida(id)) {
                    notificacoesLidas.push({
                        id: id,
                        timestamp: Date.now()
                    });
                    return true;
                }
                return false;
            }
            
            // Teste 1: Marcar nova notifica√ß√£o
            const resultado1 = marcarComoLida('notif-1');
            if (resultado1 && notificacoesLidas.length === 1) {
                adicionarTeste('‚úÖ Marcar Notifica√ß√£o', 'ok', 'Nova notifica√ß√£o marcada corretamente');
            } else {
                adicionarTeste('‚ùå Marcar Notifica√ß√£o', 'erro', 'Falha ao marcar nova notifica√ß√£o');
            }
            
            // Teste 2: Evitar duplica√ß√£o
            const resultado2 = marcarComoLida('notif-1');
            if (!resultado2 && notificacoesLidas.length === 1) {
                adicionarTeste('‚úÖ Preven√ß√£o Duplica√ß√£o', 'ok', 'Duplica√ß√£o prevenida corretamente');
            } else {
                adicionarTeste('‚ùå Preven√ß√£o Duplica√ß√£o', 'erro', 'Falha na preven√ß√£o de duplica√ß√£o');
            }
            
            // Teste 3: Compatibilidade com formato antigo
            notificacoesLidas.push('notif-old');
            if (foiLida('notif-old')) {
                adicionarTeste('‚úÖ Compatibilidade', 'ok', 'Compatibilidade com formato antigo mantida');
            } else {
                adicionarTeste('‚ùå Compatibilidade', 'erro', 'Falha na compatibilidade');
            }
        }
        
        testarFuncaoNotificacao();
        
        // Teste de limpeza de dados antigos
        function testarLimpezaAntigas() {
            const seteDiasAtras = Date.now() - (7 * 24 * 60 * 60 * 1000);
            const dados = [
                { id: 'nova', timestamp: Date.now() },
                { id: 'antiga', timestamp: seteDiasAtras - 1000 },
                'formato-antigo'
            ];
            
            const filtrados = dados.filter(item => {
                if (typeof item === 'object' && item.timestamp) {
                    return item.timestamp > seteDiasAtras;
                }
                return true;
            });
            
            if (filtrados.length === 2 && filtrados[0].id === 'nova') {
                adicionarTeste('‚úÖ Limpeza Antigas', 'ok', 'Limpeza de notifica√ß√µes antigas funcionando');
            } else {
                adicionarTeste('‚ùå Limpeza Antigas', 'erro', 'Falha na limpeza de notifica√ß√µes antigas');
            }
        }
        
        testarLimpezaAntigas();
        
        // Resumo
        setTimeout(() => {
            const testes = document.querySelectorAll('.teste');
            const sucessos = document.querySelectorAll('.ok').length;
            const erros = document.querySelectorAll('.erro').length;
            
            const resumo = document.createElement('div');
            resumo.className = 'teste ' + (erros === 0 ? 'ok' : 'warning');
            resumo.innerHTML = `
                <strong>üìä RESUMO DOS TESTES</strong><br>
                ‚úÖ Sucessos: ${sucessos}<br>
                ‚ùå Erros: ${erros}<br>
                üìã Total: ${testes.length}<br><br>
                <strong>Status: ${erros === 0 ? 'üéâ TODOS OS TESTES PASSARAM!' : '‚ö†Ô∏è ALGUNS TESTES FALHARAM'}</strong>
            `;
            resultados.appendChild(resumo);
        }, 1000);
    </script>
</body>
</html>
